const retrieve = async () => {
    const collectionRaw = window.location.href
    var cp = collectionRaw.substr(collectionRaw.lastIndexOf('?') + 1);
    const response = await fetch('https://api.are.na/v2/channels/' + cp + '/contents/?total_pages=10&amp;per=100');
    const arenaContent = await response.json();
    var array = arenaContent.contents;
    for (let i = 0; i < array.length; i++) {
        if (array[i].class == "Image") {
            let fig = document.createElement('figure');
            fig.setAttribute('id', i);
            document.getElementById('masonry').appendChild(fig);
            let img = document.createElement('img');
            if (window.location.href.includes("/collage.html?")) {
                var zrandom = Math.floor(Math.random() * 1000);
                var wrandom = Math.floor((Math.random() * 33) + 20);
                img.setAttribute('style', 'z-index: ' + zrandom + ';width: ' + (wrandom) + 'vw;');
            }
            img.src = array[i].image.display.url;
            document.getElementById(i).appendChild(img);
            console.log(i)
        }
        document.getElementById('centered').style.display = 'none';
        clearInterval(loader);
    }

}


const updateLoader = async () => {
    switch (loadState) {
        case 0:
            document.getElementById('loadText').innerHTML = '🗁  🖺           🖳';
            loadState += 1;
            break;
        case 1:
            document.getElementById('loadText').innerHTML = '🗁      🖺       🖳';
            loadState += 1;
            break;
        case 2:
            document.getElementById('loadText').innerHTML = '🗁           🖺  🖳';
            loadState += 1;
            break;
        case 3:
            document.getElementById('loadText').innerHTML = '🗀               🖳';
            loadState = 0;
            break;
    }
}

function proceed() {
    var mode = document.querySelector('input[name="mode"]:checked').value;
    var courl = document.getElementById("collection").value;
    var passurl = courl.substr(courl.lastIndexOf('/') + 1);
    var finalurl = "/" + mode + ".html?" + passurl;
    location.href = finalurl;
}

var loadState = 3;
retrieve();
let loader = setInterval(updateLoader, 200);